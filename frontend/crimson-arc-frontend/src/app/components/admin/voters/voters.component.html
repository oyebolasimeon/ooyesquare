<div class="admin-layout">
  <app-admin-sidebar #sidebar [activeRoute]="'voters'"></app-admin-sidebar>
  
  <div class="main-content">
    <app-admin-topbar [title]="'Manage Voters'" [icon]="'pi-user'" (toggleMenu)="sidebar.toggleMobileMenu()"></app-admin-topbar>
    
    <div class="content-area">
      <div class="voters-container">
        <div class="toolbar">
          <div class="search-container">
            <span class="p-input-icon-left search-box">
              <i class="pi pi-search"></i>
              <input type="text" 
                     pInputText 
                     [(ngModel)]="searchText" 
                     (input)="filterVoters()" 
                     placeholder="Search by email, phone, name, status..."
                     class="search-input" />
              <i class="pi pi-times clear-icon" 
                 *ngIf="searchText" 
                 (click)="clearSearch()"
                 pTooltip="Clear search"></i>
            </span>
            <div class="results-info" *ngIf="searchText">
              <span>{{ filteredVoters.length }} of {{ voters.length }} voters</span>
            </div>
          </div>
          <div class="action-buttons-group">
            <button pButton label="Upload Excel" icon="pi pi-upload" (click)="openUploadDialog()" class="add-btn"></button>
            <button pButton label="Resend All Emails" icon="pi pi-send" (click)="resendAllEmails()" 
                    [loading]="resendingAll" class="resend-all-btn" 
                    [disabled]="voters.length === 0"
                    pTooltip="Send credentials email to all active voters"></button>
          </div>
        </div>

        <!-- Voters Table -->
        <p-card>
          <p-table [value]="filteredVoters" [loading]="loading" [paginator]="true" [rows]="rowsPerPage" 
                   [rowsPerPageOptions]="rowsPerPageOptions" [showCurrentPageReport]="true"
                   currentPageReportTemplate="Showing {first} to {last} of {totalRecords} voters"
                   responsiveLayout="scroll" styleClass="p-datatable-striped">
            <ng-template pTemplate="header">
              <tr>
                <th>Email</th>
                <th>Phone Number</th>
                <th>First Name</th>
                <th>Last Name</th>
                <th>Maiden Name</th>
                <th>Status</th>
                <th>Has Voted</th>
                <th>Actions</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-voter>
              <tr>
                <td>{{ voter.email }}</td>
                <td>{{ voter.phoneNumber }}</td>
                <td>{{ voter.firstName || '-' }}</td>
                <td>{{ voter.lastName || '-' }}</td>
                <td>{{ voter.maidenName || '-' }}</td>
                <td>
                  <p-tag [value]="voter.status === 'active' ? 'Active' : 'Inactive'" 
                         [severity]="voter.status === 'active' ? 'success' : 'danger'"></p-tag>
                </td>
                <td>
                  <p-tag [value]="voter.hasVoted ? 'Yes' : 'No'" 
                         [severity]="voter.hasVoted ? 'info' : 'warn'"></p-tag>
                </td>
                <td class="action-buttons">
                  <button pButton 
                          type="button"
                          icon="pi pi-send" 
                          (click)="resendEmail(voter)" 
                          class="p-button-rounded p-button-text p-button-sm email-btn" 
                          pTooltip="Resend Credentials Email"
                          tooltipPosition="top"
                          [loading]="resendingEmails[voter._id]"></button>
                  <button pButton 
                          type="button"
                          [icon]="voter.status === 'active' ? 'pi pi-ban' : 'pi pi-check'" 
                          (click)="toggleVoterStatus(voter)" 
                          class="p-button-rounded p-button-text p-button-sm status-btn" 
                          [pTooltip]="voter.status === 'active' ? 'Deactivate' : 'Activate'"
                          tooltipPosition="top"></button>
                  <button pButton 
                          type="button"
                          icon="pi pi-trash" 
                          (click)="deleteVoter(voter)" 
                          class="p-button-rounded p-button-text p-button-sm delete-btn" 
                          pTooltip="Delete"
                          tooltipPosition="top"></button>
                </td>
              </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage">
              <tr>
                <td colspan="8" class="empty-message">
                  <div class="empty-state">
                    <i class="pi pi-inbox" style="font-size: 3rem; color: #94A3B8;"></i>
                    <p>No voters found. Upload an Excel file to add voters.</p>
                  </div>
                </td>
              </tr>
            </ng-template>
          </p-table>
        </p-card>
      </div>
    </div>
  </div>

  <!-- Toast Messages -->
  <p-toast></p-toast>

</div>
